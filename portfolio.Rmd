---
title: "PS811 Portfolio"
author: "David Bates"
output:
  html_document: 
    toc: true ## table of contents
    code_folding: hide
---
```{r setup, include=FALSE}
## Defaults for R chunks
knitr::opts_chunk$set(echo = TRUE, ## echo = TRUE means code will show
                      warning=FALSE, ## supress warnings and messages from R
                      message=FALSE,
                      fig.path='Figs/', ## where to save figures
                      fig.height = 3, ## default figure size (can differ in each chunk)
                      fig.width = 3)

## Add any R packages you require. 
## Here are some we will use in 811:
requires <- c("tidyverse", ## tidyverse includes dplyr and ggplot2
              "magrittr",
              "foreign",
              "readstata13",
              "here")

## Install any you don't have
to_install <- c(requires %in% rownames(installed.packages()) == FALSE)
install.packages(c(requires[to_install], "NA"), repos = "https://cloud.r-project.org/" )

## Load all required R packages
library(tidyverse)
library(ggplot2); theme_set(theme_minimal())
library(magrittr)
library(here)
```
<!-- The above header sets everything up. -->





<!-- Replace the below with bit about you. -->
##Research Interests

I am interested in international organizations, specifically regional organizations. I'm also interested in the role of international law in international relations.

##Questions I Hope to Answer
I'm curious about why and how states in a region become more federated or less federated, and why this varies across regions.

##Potential Methods
I'm interested in survey data to capture domestic opinions, data-as-text to analyze treaty language and discourse of leaders.

##Potentially relevant data:
Relevant data for these questions include:
 
1. Records of parliamentary meetings.

2. Speeches by leaders
 
3. Macroeconomic data
 
4. Migration data

5. Public opinion data
 
6. Interview data with elites and citizens.

Some potential datasets include the World Treaty Index, the UN Treaty Collection, and World Bank Data for macroeconomic indicators.

#Assignment 2:
I have compiled a dataset of member states of international courts around the world. I summarize the data as follows -- this gives us the average number of courts that a state belongs to (7), as well as the variance of this measure (6), which is not surprisingly quite high.

```{r data}
## Very cool that you are working with original data. Even if you find a source for these data, it is unlikely that they will be current to 2019, so you have at least added a time period here. My suggestions use dplyr and tidyr functions glimpse(), rename(), select(), group_by(), gather(), summarize(), and mutate(). 

# dataset <- read.csv("Dataset ready for summary.csv")
# summary(dataset)
# variance(dataset) 
##  IMPORTANT NOTE: I could not knit this without the DAKS package, which is where google tells me this `variance()` function can be found. Base R is just var(), so you could either use that, as I have below, or add DAKS to your list of packages to install and load

## Less important note: Please put data files in a data subfolder and use the here() function

d <- read.csv("Dataset ready for summary.csv") # easier to work with "d"

# you have 25 courts x 203 countries = 5075 0's and 1's in your data frame

d %<>% 
  rename(country = X) %>% 
  select(-Total) # this is a function of the data, which may change (e.g. if you find another court), so we want to create this. It can't be fixed in the raw data. 

## This raises a question of what counts as an observation.

## Will values in these data only vary by country, or might things vary among each country's memberships (e.g. the dates, roles, contributions).


## Here are these data with one observation per country per court::
d %<>% 
  group_by(country) %>% 
  gather(-country, ## gather all variables except country into variable-value pairs
         key = "court", ## name for former variables names
         value = "member" ## name for former variables values
         )

glimpse(d) # you have 25 courts x 203 countries = 5075 potential membership observations

## You may want to filter out only cases that are instances of membership (if you are only recording information about members) or not (if you are recording information about non-members)

## If this is a time series, you may need observations to be country-court-year


```

I collected data on membership in `r length(unique(d$court))`  courts for `r length(unique(d$country))` countries.

```{r summary-stats}
## The magic of group_by():
d %<>% 
  group_by(country) %>% 
  mutate(countryTotal = sum(member) ) %>%  # now sum() just operates within each country group
  ungroup() %>%
  group_by(court) %>% 
  mutate(courtTotal = sum(member) ) %>% 
  ungroup() 

country.stats <- d %>% 
  select(country, countryTotal) %>% 
  distinct() %>%
  summarise(mean = mean(countryTotal),
            variance = var(countryTotal) )

court.stats <- d %>% 
  select(court, courtTotal) %>% 
  distinct() %>%
  summarise(mean = mean(courtTotal),
            variance = var(courtTotal) )
  
```

The average number of members on each court is `r round(court.stats$mean)` and the average number or courts to which each country is a member is `r round(country.stats$mean)`.

```{r summary-plot}
d %>% ## pipe data into ggplot, same as ggplot(d)
  group_by(country) %>% 
  summarise(countryTotal = sum(member) ) %>%
  ungroup() %>% 
  ggplot() +
  geom_histogram(aes(x = countryTotal))
```


```{r summary-fig, fig.height=30, fig.width=8}
d %>% ## pipe data into ggplot, same as ggplot(d) but alows you to do stuff to d if you wnat, like filter out 0's:
  filter(member != 0) %>% 
  ggplot() + 
  aes(x = country, fill = court) + 
  geom_bar() + 
  coord_flip() + 
  theme(legend.position = 'top',
        legend.text = element_text(size = 6))
```


<!--
David, 
These data seem like good choices; perhaps you will be merging treaty and economic data? Your task now is to select a few variables of interests. Try writing a few lines of R code that loads these data from their URL and then uses select() to trim it down to the columns you want. Make sure to include any ID columns. 
If the files are very large, you may want to make a short .R script that loads from the URL, selects the variables you want, and then saves your new, smaller data file in a folder called "data" (make sure to save this script in your 811 folder, commit it, and push it). This portfolio page can then load this smaller data file from that folder using here(data/YourNewDataFile).
If you want to start working with treaty text data right off the bat, let me know and we can jump ahead to some text analysis basics--we will need to at least count some word frequencies so you have something to plot :) 
Best,
Devin
-->

